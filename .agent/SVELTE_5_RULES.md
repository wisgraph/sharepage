# Svelte 5 & Galpi 코딩 수칙 (AI 가이드라인)

이 문서는 Galpi 프로젝트의 코드 안정성과 Svelte 5 반응성 규칙 준수를 위해 AI 어시스턴트가 반드시 지켜야 할 규칙을 정의합니다.

## 1. 반응성 및 상태 관리 규칙

### 1-1. 불변 업데이트 (Immutable Updates)
- `$state`로 관리되는 객체나 배열을 **직접 수정(Mutation)하지 마십시오.**
- 특히 `$derived` 블록 내부나 템플릿 렌더링 도중에 상태를 변경하는 것은 `state_unsafe_mutation` 에러를 유발하며 앱을 중단시킵니다.
- **나쁜 예:** `ranges.sort()`, `item.count++` (원본 수정)
- **좋은 예:** `[...ranges].sort()`, `{ ...item, count: item.count + 1 }` (새 복사본 생성)

### 1-2. `$effect` 사용 최소화
- `$effect`는 상태 동기화가 아닌, **외부 시스템과의 상동 작용**(DOM 직접 조작, 네트워크 통신 등)을 위해서만 사용하십시오.
- 단순한 상태 계산은 반드시 `$derived`를 사용하십시오.
- `$effect` 내에서 상태를 변경하는 순환 구조를 피하십시오.

## 2. 로직 분리 및 테스트 규칙

### 2-1. 순수 함수로 로직 분리
- 복잡한 비즈니스 로직(네비게이션 계산, 텍스트 파싱 등)은 컴포넌트 내부가 아닌 **독립된 서비스 파일(`src/lib/services/`)에 순수 함수**로 작성하십시오.
- 이는 예측 가능성을 높이고 유닛 테스트 작성을 용이하게 합니다.

### 2-2. 회귀 방지 테스트 (Regression Testing)
- `navigationService.ts`나 `textService.ts`와 같은 핵심 로직을 수정할 경우, 반드시 대응하는 `.test.ts` 파일을 실행시켜 기존 기능이 망가지지 않았는지 확인하십시오.
- 명령: `npm run test`

## 3. 이벤트 처리 규칙

### 3-1. 동기적 이벤트 처리
- 키보드 이벤트 핸들러에서 `preventDefault()`를 호출해야 하는 경우, 핸들러 체인을 비동기(`async/await`)로 만들지 마십시오.
- 전파 중단이나 기본 동작 차단은 이벤트 발생 즉시 동기적으로 이루어져야 브라우저의 기본 동작을 완벽히 제어할 수 있습니다.

---
**이 수칙을 어길 경우 사용자의 작업 흐름이 끊기고 심각한 버그가 발생할 수 있음을 명심하십시오.**
